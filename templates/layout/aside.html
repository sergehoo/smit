{% load static %}

<!-- sidebar @s -->
<div class="nk-sidebar nk-sidebar-fixed shadow" data-content="sidebarMenu">
  <!-- Header -->
  <div class="nk-sidebar-element nk-sidebar-head">
    <div class="nk-sidebar-brand">
      <a href="{% url 'home' %}" class="logo-link nk-sidebar-logo">
        <img class="logo-light logo-img" src="{% static 'images/lyne_hospital.png' %}" alt="logo">
        <img class="logo-dark logo-img" src="{% static 'images/lyne_hospital.png' %}" alt="logo-dark">
      </a>
      
        <a href="{% url 'home' %}" class="logo-link nk-sidebar-logo">
        <img class="logo-light logo-img" src="{% static 'images/logocermipa.png' %}" alt="logo">
        <img class="logo-dark logo-img" src="{% static 'images/logocermipa.png' %}" alt="logo-dark">
      </a><span class="sidebar-brand-title">SMIT</span>
    </div>

    <div class="nk-menu-trigger mr-n2">
      <a href="#" class="nk-nav-toggle nk-quick-nav-icon d-xl-none" data-target="sidebarMenu" aria-label="Fermer le menu">
        <em class="icon ni ni-arrow-left"></em>
      </a>
    </div>
  </div>

  <div class="sidebar-department">
    SERVICE DES MALADIES INFESTIEUSES ET TROPICALES
  </div>

  <!-- Body -->
  <div class="nk-sidebar-element">
    <div class="nk-sidebar-body" data-simplebar>
      <div class="nk-sidebar-content">

        <!-- User Card -->
        <div class="nk-sidebar-user">
          <div class="user-avatar">
            <span class="user-initials">{{ user.first_name|slice:1 }}{{ user.last_name|slice:1 }}</span>
          </div>

          <div class="user-info">
            <div class="user-name">Dr. {{ user.get_full_name|default:user.username }}</div>
            <div class="user-role">{{ user.groups.first.name|default:"Médecin" }}</div>
          </div>

          <div class="user-status online" title="Connecté"></div>
        </div>

        <!-- Menu -->
        <div class="nk-sidebar-menu">
          <ul class="nk-menu">

            <!-- Générale -->
            <li class="nk-menu-heading">
              <h6 class="overline-title text-primary-alt">Générale</h6>
            </li>

            <li class="nk-menu-item">
              <a href="{% url 'home' %}" class="nk-menu-link">
                <span class="nk-menu-icon">
                  <span class="medical-icon"><em class="icon ni ni-dashboard-fill text-primary"></em></span>
                </span>
                <span class="nk-menu-text text-dark">Dashboard</span>
              </a>
            </li>

            <li class="nk-menu-item">
              <a href="{% url 'global_search' %}" class="nk-menu-link">
                <span class="nk-menu-icon">
                  <span class="medical-icon"><em class="icon ni ni-search"></em></span>
                </span>
                <span class="nk-menu-text">Recherche</span>
                <span class="nk-menu-badge">{{ patient_nbr }}</span>
              </a>
            </li>

            <!-- Accueil -->
            <li class="nk-menu-heading">
              <h6 class="overline-title text-primary-alt">Accueil</h6>
            </li>

            <li class="nk-menu-item">
              <a href="{% url 'attente' %}" class="nk-menu-link">
                <span class="nk-menu-icon">
                  <span class="medical-icon"><em class="icon ni ni-users-fill"></em></span>
                </span>
                <span class="nk-menu-text">Salle d'attente</span>
                <span class="nk-menu-badge badge-danger">{{ apointments_nbr }}</span>
              </a>
            </li>

            <li class="nk-menu-item">
              <a href="{% url 'appointment_over' %}" class="nk-menu-link">
                <span class="nk-menu-icon">
                  <span class="medical-icon"><em class="icon ni ni-calendar-check"></em></span>
                </span>
                <span class="nk-menu-text">Patients reçus</span>
                <span class="nk-menu-badge">{{ appointments_all }}</span>
              </a>
            </li>

            <li class="nk-menu-item">
              <a href="{% url 'appointment_list' %}" class="nk-menu-link">
                <span class="nk-menu-icon">
                  <span class="medical-icon"><em class="icon ni ni-calendar-booking-fill"></em></span>
                </span>
                <span class="nk-menu-text">Rendez-vous</span>
                <span class="nk-menu-badge">{{ appointments_all }}</span>
              </a>
            </li>

            <!-- Consultation -->
            <li class="nk-menu-heading">
              <h6 class="overline-title text-primary-alt">Consultation</h6>
            </li>

            <li class="nk-menu-item">
              <a href="{% url 'consultation_list' %}" class="nk-menu-link">
                <span class="nk-menu-icon">
                  <span class="medical-icon"><i class="fa-solid fa-stethoscope"></i></span>
                </span>
                <span class="nk-menu-text">Liste Consultations</span>
                <span class="nk-menu-badge">{{ consul_nbr }}</span>
              </a>
            </li>

            <!-- Urgences -->
            <li class="nk-menu-heading">
              <h6 class="overline-title text-primary-alt">Urgences</h6>
            </li>

            <li class="nk-menu-item">
              <a href="{% url 'urgences_list' %}" class="nk-menu-link">
                <span class="nk-menu-icon">
                  <span class="medical-icon icon-danger"><i class="fa-solid fa-ambulance"></i></span>
                </span>
                <span class="nk-menu-text">Liste des Urgences</span>
                <span class="nk-menu-badge">{{ urgencehospi }}</span>
              </a>
            </li>

            <!-- Hospitalisation -->
            <li class="nk-menu-heading">
              <h6 class="overline-title text-primary-alt">Hospitalisation</h6>
            </li>

            <li class="nk-menu-item">
              <a href="{% url 'hospitalisation' %}" class="nk-menu-link">
                <span class="nk-menu-icon">
                  <span class="medical-icon"><i class="fa-solid fa-bed-pulse"></i></span>
                </span>
                <span class="nk-menu-text">En cours d'hospitalisation</span>
                <span class="nk-menu-badge badge-danger">{{ Hospitaliza_encours }}</span>
              </a>
            </li>

            <li class="nk-menu-item">
              <a href="{% url 'suivie_soins_list' %}" class="nk-menu-link">
                <span class="nk-menu-icon">
                  <span class="medical-icon"><i class="fa-solid fa-clock-rotate-left"></i></span>
                </span>
                <span class="nk-menu-text">Suivi soins hospitalisation</span>
                <span class="nk-menu-badge badge-danger">{{ Hospitaliza_encours }}</span>
              </a>
            </li>

            <li class="nk-menu-item">
              <a href="{% url 'hospitalised_patient' %}" class="nk-menu-link">
                <span class="nk-menu-icon">
                  <span class="medical-icon"><i class="fa-solid fa-bed"></i></span>
                </span>
                <span class="nk-menu-text">Patients Sortis</span>
                <span class="nk-menu-badge">{{ discharged_count }}</span>
              </a>
            </li>

            <li class="nk-menu-item">
              <a href="{% url 'hospi_unites' %}" class="nk-menu-link">
                <span class="nk-menu-icon">
                  <span class="medical-icon"><i class="fa-solid fa-hospital"></i></span>
                </span>
                <span class="nk-menu-text">Unités d'hospitalisation</span>
              </a>
            </li>

            <!-- Paramètres hospi (submenu) -->
            <li class="nk-menu-item has-sub">
              <a href="#" class="nk-menu-link nk-menu-toggle" aria-expanded="false">
                <span class="nk-menu-icon">
                  <span class="medical-icon"><i class="fa-solid fa-gears"></i></span>
                </span>
                <span class="nk-menu-text">Paramètres</span>
                <span class="submenu-caret"><em class="icon ni ni-chevron-right"></em></span>
              </a>
              <ul class="nk-menu-sub">
                <li class="nk-menu-item">
                  <a href="#" class="nk-menu-link">
                    <span class="sub-dot"></span>
                    <span class="nk-menu-text">Analyses</span>
                  </a>
                </li>
                <li class="nk-menu-item">
                  <a href="#" class="nk-menu-link">
                    <span class="sub-dot"></span>
                    <span class="nk-menu-text">Kits</span>
                  </a>
                </li>
              </ul>
            </li>

            <!-- Suivi -->
            <li class="nk-menu-heading">
              <h6 class="overline-title text-primary-alt">Suivi Patients</h6>
            </li>

            <li class="nk-menu-item">
              <a href="{% url 'bilan_list' %}" class="nk-menu-link">
                <span class="nk-menu-icon">
                  <span class="medical-icon"><i class="fa-solid fa-file-arrow-up"></i></span>
                </span>
                <span class="nk-menu-text">Bilans Initiaux</span>
                <span class="nk-menu-badge badge-primary">{{ bilaninitial }}</span>
              </a>
            </li>

            <li class="nk-menu-item">
              <a href="{% url 'suivi_list' %}" class="nk-menu-link">
                <span class="nk-menu-icon">
                  <span class="medical-icon"><i class="fa-solid fa-folder-tree"></i></span>
                </span>
                <span class="nk-menu-text">Suivi des Patients</span>
                <span class="nk-menu-badge badge-danger">{{ suivi_nbr }}</span>
              </a>
            </li>

            <!-- Maladies -->
            <li class="nk-menu-heading">
              <h6 class="overline-title text-primary-alt">Maladies sous surveillance</h6>
            </li>

            {% for maladie in services %}
              <li class="nk-menu-item has-sub">
                <a href="#" class="nk-menu-link nk-menu-toggle" aria-expanded="false">
                  <span class="nk-menu-icon">
                    <span class="medical-icon"><i class="fa-solid fa-virus"></i></span>
                  </span>
                  <span class="nk-menu-text">{{ maladie }}</span>
                  <span class="submenu-caret"><em class="icon ni ni-chevron-right"></em></span>
                </a>
                <ul class="nk-menu-sub">
                  {% for sbactivity in maladie.subactivities.all %}
                    <li class="nk-menu-item">
                      <a href="{% url 'service_content_detail' serv=maladie.nom acty=sbactivity.nom pk=sbactivity.id %}"
                         class="nk-menu-link">
                        <span class="sub-dot"></span>
                        <span class="nk-menu-text">{{ sbactivity.nom }}</span>
                      </a>
                    </li>
                  {% endfor %}
                </ul>
              </li>
            {% endfor %}

            <!-- Laboratoire -->
            <li class="nk-menu-heading">
              <h6 class="overline-title text-primary-alt">Laboratoire</h6>
            </li>

            <li class="nk-menu-item">
              <a href="{% url 'echantillons_list' %}" class="nk-menu-link">
                <span class="nk-menu-icon">
                  <span class="medical-icon"><i class="fa-solid fa-vial"></i></span>
                </span>
                <span class="nk-menu-text">Prélèvements</span>
              </a>
            </li>

            <li class="nk-menu-item">
              <a href="{% url 'examen_list' %}" class="nk-menu-link">
                <span class="nk-menu-icon">
                  <span class="medical-icon"><i class="fa-solid fa-flask-vial"></i></span>
                </span>
                <span class="nk-menu-text">Demande d'Analyse</span>
                <span class="nk-menu-badge badge-danger">{{ examencount }}</span>
              </a>
            </li>

            <li class="nk-menu-item">
              <a href="{% url 'examen_done_list' %}" class="nk-menu-link">
                <span class="nk-menu-icon">
                  <span class="medical-icon"><i class="fa-solid fa-clipboard-check"></i></span>
                </span>
                <span class="nk-menu-text">Analyses effectuées</span>
                <span class="nk-menu-badge">{{ examensdonecount }}</span>
              </a>
            </li>

            <!-- Pharmacie -->
            <li class="nk-menu-heading">
              <h6 class="overline-title text-primary-alt">Pharmacie</h6>
            </li>

            <li class="nk-menu-item">
              <a href="{% url 'medicaments' %}" class="nk-menu-link">
                <span class="nk-menu-icon">
                  <span class="medical-icon"><i class="fa-solid fa-prescription-bottle-medical"></i></span>
                </span>
                <span class="nk-menu-text">Médicaments</span>
              </a>
            </li>

            <li class="nk-menu-item">
              <a href="{% url 'mouvement-stock' %}" class="nk-menu-link">
                <span class="nk-menu-icon">
                  <span class="medical-icon"><i class="fa-solid fa-arrow-down-up-across-line"></i></span>
                </span>
                <span class="nk-menu-text">Mouvement de stock</span>
              </a>
            </li>

            <li class="nk-menu-item">
              <a href="{% url 'rendezvous_list' %}" class="nk-menu-link">
                <span class="nk-menu-icon">
                  <span class="medical-icon"><i class="fa-solid fa-calendar"></i></span>
                </span>
                <span class="nk-menu-text">Rendez-vous</span>
              </a>
            </li>

            <li class="nk-menu-item">
              <a href="{% url 'commandes-list' %}" class="nk-menu-link">
                <span class="nk-menu-icon">
                  <span class="medical-icon"><i class="fa-solid fa-basket-shopping"></i></span>
                </span>
                <span class="nk-menu-text">Commandes</span>
              </a>
            </li>

            <li class="nk-menu-item">
              <a href="#" class="nk-menu-link">
                <span class="nk-menu-icon">
                  <span class="medical-icon"><i class="fa-solid fa-chart-bar"></i></span>
                </span>
                <span class="nk-menu-text">Rapports</span>
              </a>
            </li>

            <!-- Paramètres -->
            <li class="nk-menu-heading">
              <h6 class="overline-title text-primary-alt">Paramètres</h6>
            </li>

            <li class="nk-menu-item">
              <a href="{% url 'employee_list' %}" class="nk-menu-link">
                <span class="nk-menu-icon">
                  <span class="medical-icon"><i class="fa-solid fa-user-circle"></i></span>
                </span>
                <span class="nk-menu-text">Gestion des Employés</span>
              </a>
            </li>

            <li class="nk-menu-item">
              <a href="{% url 'user_role' %}" class="nk-menu-link">
                <span class="nk-menu-icon">
                  <span class="medical-icon"><i class="fa-solid fa-user-secret"></i></span>
                </span>
                <span class="nk-menu-text">Gestion des Rôles</span>
              </a>
            </li>

          </ul>

          <!-- Quick Actions -->
          <div class="sidebar-quick-actions">
            <div class="quick-actions-title">Actions Rapides</div>

            <div class="quick-actions-grid">
              <a href="{% url 'add_patient' %}" class="quick-action-item qa-danger">
                <i class="fa-solid fa-user-plus"></i>
                <span>Nouveau Patient</span>
              </a>

              <a href="{% url 'consultation_list' %}" class="quick-action-item qa-primary">
                <i class="fa-solid fa-stethoscope"></i>
                <span>Nouvelle Consultation</span>
              </a>

              <a href="{% url 'examen_list' %}" class="quick-action-item qa-warning">
                <i class="fa-solid fa-flask-vial"></i>
                <span>Demande d'Analyse</span>
              </a>

              <a href="{% url 'urgences_list' %}" class="quick-action-item qa-teal">
                <i class="fa-solid fa-ambulance"></i>
                <span>Cas Urgent</span>
              </a>
            </div>
          </div>

        </div><!-- .nk-sidebar-menu -->
      </div><!-- .nk-sidebar-content -->
    </div><!-- .nk-sidebar-body -->
  </div><!-- .nk-sidebar-element -->
</div>
<!-- sidebar @e -->


<style>
  /* ============== Sidebar brand ============== */
  .sidebar-brand-title{
    font-weight: 900;
    color: var(--text);
    margin-left: 5px;
    letter-spacing: .4px;
  }
  html[data-theme="dark"] .sidebar-brand-title{
    color: var(--text);
  }

  .sidebar-department{
    font-size: 10px;
    padding: 10px 7px;
    text-align: center;
    color: var(--muted);
    border-bottom: 1px solid var(--border);
    letter-spacing: .6px;
    text-transform: uppercase;
  }

  /* ============== User card ============== */
  .nk-sidebar-user{
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 14px 14px;
    border-bottom: 1px solid var(--border);
    background: linear-gradient(135deg, rgba(7, 85, 232, 0.22) 0%, rgba(2, 48, 83, 0.65) 100%);
  }
  html[data-theme="dark"] .nk-sidebar-user{
    background: linear-gradient(135deg, rgba(14,165,233,.18) 0%, rgba(3,105,161,.20) 100%);
  }

  .user-avatar{
    width: 46px;
    height: 46px;
    border-radius: 14px;
    display: grid;
    place-items: center;
    border: 2px solid rgba(255,255,255,.55);
    background: rgba(15,23,42,.30);
    flex: 0 0 auto;
    overflow: hidden;
  }

  .user-initials{
    font-weight: 900;
    color: #fff;
    letter-spacing: .5px;
  }

  .user-info{ flex: 1; min-width: 0; }
  .user-name{
    font-weight: 800;
    color: #fff;
    font-size: .95rem;
    line-height: 1.1;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .user-role{
    font-size: .78rem;
    color: rgba(255,255,255,.88);
    margin-top: 2px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .user-status{
    width: 12px;
    height: 12px;
    border-radius: 999px;
    border: 2px solid rgba(255,255,255,.9);
    flex: 0 0 auto;
  }
  .user-status.online{ background: var(--success); }
  .user-status.offline{ background: var(--danger); }

  /* ============== Submenu visuals ============== */
  .submenu-caret{
    margin-left: auto;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 26px;
    height: 26px;
    border-radius: 10px;
    background: rgba(14,165,233,.10);
    transition: transform .28s var(--ease), background .28s var(--ease);
  }
  html[data-theme="dark"] .submenu-caret{
    background: rgba(14,165,233,.14);
  }

  .nk-menu-item.has-sub.open > .nk-menu-toggle .submenu-caret{
    transform: rotate(90deg);
    background: rgba(14,165,233,.18);
  }

  /* Submenu dot */
  .sub-dot{
    width: 8px;
    height: 8px;
    border-radius: 999px;
    background: rgba(14,165,233,.55);
    display: inline-block;
    margin-right: 10px;
    flex: 0 0 auto;
  }
  html[data-theme="dark"] .sub-dot{
    background: rgba(14,165,233,.65);
  }

  /* ============== Badges premium ============== */
  .nk-menu-badge{
    border-radius: 999px;
    font-weight: 800;
    font-size: 12px;
    padding: 4px 10px;
    background: rgba(100,116,139,.12);
    color: var(--text-2);
    border: 1px solid rgba(100,116,139,.16);
  }
  html[data-theme="dark"] .nk-menu-badge{
    background: rgba(148,163,184,.12);
    color: var(--text-2);
    border-color: rgba(148,163,184,.18);
  }

  .nk-menu-badge.badge-danger{
    background: rgba(239,68,68,.14);
    color: #991b1b;
    border-color: rgba(239,68,68,.22);
  }
  html[data-theme="dark"] .nk-menu-badge.badge-danger{
    color: #fecaca;
  }

  .nk-menu-badge.badge-primary{
    background: rgba(14,165,233,.16);
    color: var(--primary-700);
    border-color: rgba(14,165,233,.26);
  }
  html[data-theme="dark"] .nk-menu-badge.badge-primary{
    color: #e0f2fe;
  }

  /* Danger icon helper */
  .medical-icon.icon-danger{
    background: rgba(239,68,68,.14) !important;
    color: #ef4444 !important;
  }
  .nk-menu-link:hover .medical-icon.icon-danger{
    background: #ef4444 !important;
    color: #fff !important;
  }

  /* ============== Quick actions premium ============== */
  .sidebar-quick-actions{
    padding: 16px 14px 18px;
    border-top: 1px solid var(--border);
    margin-top: 12px;
  }
  .quick-actions-title{
    font-size: .78rem;
    font-weight: 900;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: .7px;
    margin-bottom: 12px;
  }
  .quick-actions-grid{
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
  }

  .quick-action-item{
    display: grid;
    place-items: center;
    gap: 6px;
    padding: 12px 10px;
    border-radius: 14px;
    color: #fff !important;
    text-decoration: none !important;
    font-weight: 800;
    line-height: 1.1;
    border: 1px solid rgba(255,255,255,.16);
    box-shadow: 0 10px 22px rgba(2, 8, 23, .08);
    transition: transform .28s var(--ease), box-shadow .28s var(--ease), filter .28s var(--ease);
  }

  .quick-action-item i{ font-size: 1.15rem; }
  .quick-action-item span{ font-size: .72rem; text-align: center; opacity: .95; }

  .quick-action-item:hover{
    transform: translateY(-3px);
    box-shadow: 0 16px 34px rgba(2, 8, 23, .12);
    filter: brightness(1.02);
  }

  /* Color variants aligned to system tokens */
  .qa-primary{ background: linear-gradient(135deg, var(--primary) 0%, var(--primary-700) 100%); }
  .qa-danger{ background: linear-gradient(135deg, #ef4444 0%, #b91c1c 100%); }
  .qa-warning{ background: linear-gradient(135deg, #f59e0b 0%, #b45309 100%); }
  .qa-teal{ background: linear-gradient(135deg, #14b8a6 0%, #0f766e 100%); }
</style>